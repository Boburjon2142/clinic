{% extends 'base.html' %}
{% block title %}Foydalanuvchilar{% endblock %}
{% block content %}
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3 class="mb-0">Foydalanuvchilar boshqaruvi</h3>
    <a class="btn btn-outline-secondary" href="/admin/dashboard/settings/">Sozlamalar</a>
  </div>
  <div class="table-responsive neo-card p-2 allow-overflow">
    <table class="table table-striped mb-0 align-middle allow-overflow">
      <thead>
        <tr><th>Username</th><th>Ism</th><th>Rol</th><th>Holat</th><th class="text-end">Amallar</th></tr>
      </thead>
      <tbody>
        {% for u in users %}
        <tr>
          <td>{{ u.username }}</td>
          <td>{{ u.get_full_name|default:u.username }}</td>
          <td>
            {% if u.role == 'admin' %}
              <span class="badge rounded-pill text-bg-primary">admin</span>
            {% elif u.role == 'admin1' %}
              <span class="badge rounded-pill text-bg-info">admin1</span>
            {% elif u.role == 'admin2' %}
              <span class="badge rounded-pill text-bg-warning text-dark">admin2</span>
            {% elif u.role == 'admin3' %}
              <span class="badge rounded-pill text-bg-success">admin3</span>
            {% else %}
              <span class="badge rounded-pill text-bg-secondary">{{ u.role }}</span>
            {% endif %}
          </td>
          <td>{{ u.is_active|yesno:"Faol,Bloklangan" }}</td>
          <td class="text-end">
            {% if not u.is_superuser %}
              <form method="post" action="/admin/dashboard/users/{{ u.id }}/toggle_active/" class="d-inline">
                {% csrf_token %}
                <button class="btn btn-sm btn-outline-secondary">{% if u.is_active %}Bloklash{% else %}Faollashtirish{% endif %}</button>
              </form>
              {% if u.role == 'admin' or u.role == 'admin1' or u.role == 'admin2' or u.role == 'admin3' %}
                <form method="post" action="/admin/dashboard/users/{{ u.id }}/remove_admin/" class="d-inline ms-1">
                  {% csrf_token %}
                  <button class="btn btn-sm btn-outline-danger">Adminni o'chirish</button>
                </form>
              {% else %}
                <div class="btn-group dropup ms-1">
                  <button type="button" class="btn btn-sm btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown" aria-expanded="false">
                    Admin berish
                  </button>
                  <ul class="dropdown-menu dropdown-menu-end">
                    <li>
                      <form method="post" action="/admin/dashboard/users/{{ u.id }}/make_admin1/">
                        {% csrf_token %}
                        <button type="submit" class="dropdown-item">Admin 1 — Ma'lumot kiritish</button>
                      </form>
                    </li>
                    <li>
                      <form method="post" action="/admin/dashboard/users/{{ u.id }}/make_admin2/">
                        {% csrf_token %}
                        <button type="submit" class="dropdown-item">Admin 2 — Narx belgilash</button>
                      </form>
                    </li>
                    <li>
                      <form method="post" action="/admin/dashboard/users/{{ u.id }}/make_admin3/">
                        {% csrf_token %}
                        <button type="submit" class="dropdown-item">Admin 3 — To'lov (kassir)</button>
                      </form>
                    </li>
                  </ul>
                </div>
              {% endif %}
            {% endif %}
          </td>
        </tr>
        {% empty %}
        <tr><td colspan="5" class="text-center">Foydalanuvchilar topilmadi</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% endblock %}
